<link rel="import" href="/bower_components/polymer/polymer.html">
<script src="/dist/bundle.js"></script>

<dom-module id="tikkun-line">
    <template>
        <style>

            .line {
                position: relative;

                text-align: justify;
                line-height: 100%;
                display: flex;
                justify-content: space-between;
            }

            .line.mod-petucha {
                text-align: start;
            }


            .column {
                flex: 1;
                display: flex;
                justify-content: space-between;
            }

            .column:nth-child(2) {
                /*HACK: this rule is a special hack for פרשת האזינו
                to properly display the columns:
                    a) with space between the columns
                    b) without the column line breaking into two
                */
                margin-right: 5em;
                width: 12em;
            }


            .fragment {
                width: 100%;
            }

            .fragment.mod-setuma {
                width: auto;
            }

            .fragment:after {
                content: '';
                width: 100%;
                display: inline-block;
            }

            .location-indicator {
                position: absolute;
                font-family: sans-serif;
                font-size: 0.8em;
            }

            .location-indicator.mod-verses {
                right: -6ch;
                color: hsla(0, 0%, 0%, 0.35);
            }

            .location-indicator.mod-aliyot {
                right: -13ch;
                color: hsla(203, 100%, 50%, 0.75);
                max-width: 8ch;
            }

        </style>

        <div class$="line {{petuchaClass(petucha)}}">
            <template is="dom-repeat" items="{{columns}}" as="column">
                <div class="column ">
                    <template is="dom-repeat" items="{{column}}" as="fragment">
                        <div class$="fragment {{setumaClass(column)}}">{{displayText(fragment, annotated)}}</span>
                    </template>
                </div>
            </template>
            <span class="location-indicator mod-verses" hidden$="{{!annotated}}">{{asVersesRange(verses)}}</span>
            <span class="location-indicator mod-aliyot" hidden$="{{!annotated}}">{{asAliyotRange(aliyot)}}</span>
        </div>
    </template>

    <script>
        const {textFilter, hebrewNumeralFromInteger, displayRange} = TikkunApp

        Polymer({
            is: 'tikkun-line',

            properties: {
                columns: Array,
                verses: Array,
                aliyot: Array,
                petucha: Boolean,
                annotated: Boolean
            },

            petuchaClass: function (isPetucha) {
                return isPetucha
                    ? 'mod-petucha'
                    : '';
            },

            setumaClass: function (column) {
                return column.length > 1
                    ? 'mod-setuma'
                    : '';
            },

            displayText: (text, annotated) => textFilter({text, annotated}),

            asVersesRange: displayRange.asVersesRange,

            asAliyotRange: displayRange.asAliyotRange
        })
    </script>
</dom-module>
